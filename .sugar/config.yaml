# Sugar Configuration for heterodyne_detector
# Documentation: https://github.com/roboticforce/sugar
sugar:
  # Core Loop Settings
  loop_interval: 300  # Seconds between discovery cycles
  max_concurrent_work: 3  # Max tasks to execute per cycle
  dry_run: true  # Safe mode - set to false to execute tasks

  # Claude Agent SDK Integration (V3)
  claude:
    command: "claude"  # Auto-detected Claude CLI path
    timeout: 1800  # Max seconds per task (30 min)

    # Model and permissions
    model: "claude-sonnet-4-20250514"
    permission_mode: "acceptEdits"  # default | acceptEdits | bypassPermissions

    # Quality gates (pre/post execution checks)
    quality_gates:
      enabled: true

    # MCP servers (optional - uncomment to configure)
    # mcp_servers:
    #   filesystem:
    #     command: "npx"
    #     args: ["-y", "@anthropic/mcp-fs"]

  # Work Discovery
  discovery:
    # Directories excluded from all discovery modules
    global_excluded_dirs: [
      "node_modules", ".git", "__pycache__",
      "venv", ".venv", "env", ".env",
      "build", "dist", ".tox", ".nox",
      "coverage", "htmlcov", ".pytest_cache",
      ".sugar", ".claude"
    ]

    error_logs:
      enabled: true
      paths: ["logs/errors/", "logs/feedback/", ".sugar/logs/"]
      patterns: ["*.json", "*.log"]
      max_age_hours: 24

    github:
      enabled: true  # GitHub CLI detected and authenticated
      repo: "kryptodogg/heterodyne_detector"  # Auto-detected from git remote
      
      # Authentication method: using GitHub CLI
      auth_method: "gh_cli"  # GitHub CLI is authenticated
      
      # GitHub CLI integration  
      gh_cli:
        command: "gh"  # GitHub CLI detected
        use_default_auth: true  # Using existing gh authentication
        
      # Discovery settings  
      issue_labels: []  # No filtering - work on ALL open issues
      check_interval_minutes: 30
      # Label filtering options:
      # issue_labels: ["bug", "enhancement"]  # Specific labels to watch
      # issue_labels: []                      # No filtering - work on ALL open issues  
      # issue_labels: ["*"]                   # Work on issues with any labels (exclude unlabeled)
      # issue_labels: ["unlabeled"]           # Work only on issues without labels
      
      # Workflow settings for completed work
      workflow:
        # Auto-close issues after successful completion
        auto_close_issues: true
        
        # Git workflow: "direct_commit" or "pull_request"
        git_workflow: "direct_commit"  # direct_commit|pull_request
        
        # Branch settings (used when git_workflow: "pull_request")
        branch:
          # Auto-create feature branches for each issue
          create_branches: true
          # Branch naming pattern (variables: {issue_number}, {issue_title_slug})
          name_pattern: "sugar/issue-{issue_number}"
          # Base branch for new branches and PRs
          base_branch: "main"
          
        # Pull request settings (used when git_workflow: "pull_request")
        pull_request:
          # Auto-create PRs after completing work
          auto_create: true
          # Auto-merge PRs (only if all checks pass)
          auto_merge: false
          # PR title pattern (variables: same as branch naming)
          title_pattern: "Fix #{issue_number}: {issue_title}"
          # Include work summary in PR description
          include_work_summary: true
          
        # Commit settings
        commit:
          # Include issue reference in commit messages
          include_issue_ref: true
          # Commit message pattern (variables: {issue_number}, {work_summary})
          message_pattern: "Fix #{issue_number}: {work_summary}"
          # Auto-commit changes after completing work
          auto_commit: true

    code_quality:
      enabled: true
      root_path: "."
      file_extensions: [".py", ".js", ".ts", ".jsx", ".tsx"]
      max_files_per_scan: 50

    test_coverage:
      enabled: true
      root_path: "."
      source_dirs: ["src", "lib", "app", "api", "server"]
      test_dirs: ["tests", "test", "__tests__", "spec"]

  # Storage
  storage:
    database: ".sugar/sugar.db"
    backup_interval: 3600

  # Safety
  safety:
    max_retries: 3
    excluded_paths: ["/System", "/usr/bin", "/etc", ".sugar"]

  # Logging
  logging:
    level: "INFO"
    file: ".sugar/sugar.log"

  # Workflow System
  workflow:
    # Profiles: solo (direct commits), balanced (PRs), enterprise (full governance)
    profile: "solo"

  # Issue Responder (AI-powered issue responses)
  issue_responder:
    enabled: false              # Enable automatic issue responses

    # Response behavior
    auto_post_threshold: 0.8    # Min confidence to auto-post (0.0-1.0)
    max_response_length: 2000   # Max chars per response
    response_delay_seconds: 0   # Delay before posting (0 = immediate)

    # Rate limiting
    rate_limit_per_hour: 10     # Max responses per hour (0 = unlimited)

    # Issue filtering
    respond_to_labels: []       # Empty = all issues, or ["question", "bug"]
    skip_labels: ["wontfix", "duplicate", "stale"]
    skip_bot_issues: true       # Skip issues created by bots

    # Follow-up handling
    handle_follow_ups: "ignore" # "ignore" | "queue" | "auto"

    # Model selection
    model: "claude-sonnet-4-20250514"

  # Ralph Wiggum (iterative AI execution)
  ralph:
    enabled: true                   # Allow Ralph mode for tasks
    max_iterations: 10              # Default max iterations per task
    iteration_timeout: 300          # Max seconds per iteration (5 min)
    completion_promise: "DONE"      # Default completion signal
    require_completion_criteria: true  # Require <promise> tags or --max-iterations
    quality_gates_enabled: true     # Run quality gates between iterations
    stop_on_gate_failure: false     # Keep trying even if gates fail
